{% extends "base.html" %}
{% block content %}

    <h1>Shottie</h1>
    <hr>
    <h3>Instructions</h3>
    <ul>
        <li>Enter your Saucelabs username and access key</li>
        <li>Enter the URL/s you'd like to hit (comma separated)</li>
        <li>Enter any required Webdriver commands (e.g. find_element_by_xpath, click, etc)</li>
        <li>Select the browser, platform and version you want and click Add Combination</li>
        <li>Click Start Screenshotting to start the screenshotting jobs</li>
    </ul>
    <hr>
    <form action="" method="post" name="submit">
        {{ form.hidden_tag() }}
        <p>
            Saucelabs Username:<br>
            {{ form.username(class_="form-control") }}<br>
            {% for error in form.username.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>

            Saucelabs Access Key:<br>
            {{ form.accesskey(class_="form-control") }}<br>
            {% for error in form.accesskey.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>

            Saucelabs Tunnel Name:<br>
            {{ form.tunnelname(class_="form-control") }}<br>
            {% for error in form.tunnelname.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>

            Screenshot URLs:<br>
            {{ form.urls(class_="form-control") }}<br>
            {% for error in form.urls.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>

            Webdriver commands:<br>
            {{ form.commands(cols=80, rows=5, class_="form-control") }}<br>
            {% for error in form.urls.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>

            Browser:<br>
            {{ form.select_browser(class_="form-control") }}<br>
            {% for error in form.select_browser.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>

            Platform:<br>
            {{ form.select_platform(class_="form-control") }}<br>
            {% for error in form.select_platform.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>

            Version:<br>
            {{ form.select_version(class_="form-control") }}<br>
            {% for error in form.select_version.errors %}
                <span style="color: red;">[{{ error }}]</span>
            {% endfor %}<br>
      </p>
        <p>{{ form.clear(class_="btn btn-warning") }}</p>
        <p>{{ form.add(class_="btn btn-info") }}</p>
        <p>{{ form.runtests(class_="btn btn-success") }}</p>

        {% for saved_combination in saved_combinations %}
        <span><p>{{ saved_combination }}</p></span>
        {% endfor %}
  </form>

<script charset="utf-8" type="text/javascript">

$(function() {

    // jQuery selection for the 2 select boxes
    var dropdown = {
        platform: $('#select_platform'),
        browser: $('#select_browser'),
        version: $('#select_version')
    };

    // call to update on load
    updateVersions();
    updatePlatforms();

    // function to call XHR and update browser dropdown
    function updateVersions() {

        dropdown.version.attr('disabled', 'disabled');
        dropdown.version.empty();

        $.getJSON("versions/"+dropdown.browser.val(), function(data) {
            data.forEach(function(item) {
                dropdown.version.append(
                    $('<option>', {
                        value: item[0],
                        text: item[1]
                    })
                );
            });
            dropdown.version.removeAttr('disabled');
        });
    }

    function updatePlatforms() {
        var send = {
            platform: dropdown.version.val()
        };
        dropdown.platform.attr('disabled', 'disabled');
        dropdown.platform.empty();

        $.getJSON("operating_systems/"+dropdown.browser.val(), function(data) {
            data.forEach(function(item) {
                dropdown.platform.append(
                    $('<option>', {
                        value: item[0],
                        text: item[1]
                    })
                );
            });
            dropdown.platform.removeAttr('disabled');
        });
    }

    dropdown.browser.on('change', function() {
        updateVersions();
        updatePlatforms();
    });

});

</script>
{% endblock %}